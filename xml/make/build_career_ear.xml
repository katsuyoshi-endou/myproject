<?xml version="1.0" encoding="Shift_JIS"?>

<project name="hcdb" default="make-career-ear" basedir="..">
    <!-- プロパティファイルのコピー  -->
    <target name="copy-properties" unless="j2ee.home">
        <copy file="make/build-sample.properties" tofile="make/build.properties" />
    </target>

    <!-- プロパティファイルの読み込み  -->
    <target name="read-properties" depends="copy-properties">
        <loadproperties srcFile="make/build.properties" />
    </target>

    <!-- クラスパスの定義 -->
    <target name="read-path" depends="read-properties">
        <path id="hcdb.classpath">
            <fileset dir="${lib.dir}">
                <include name="**/*.jar" />
            </fileset>
            <fileset dir="${j2ee.home}">
                <include name="lib/**/*.jar" />
            </fileset>
            <pathelement location="${oracle.jdbc.jar}" />
        </path>
    </target>

    <!-- EJBDoclet -->
    <target name="ejbdoclet" depends="read-path">
        <mkdir dir="${gensrc.dir}" />
        <!-- XDoclet タスクの定義 -->
        <taskdef name="ejbdoclet" classname="xdoclet.modules.ejb.EjbDocletTask" classpathref="hcdb.classpath">
            <classpath>
                <fileset dir="${xdoclet.home}">
                    <include name="**/*.jar" />
                </fileset>
            </classpath>
        </taskdef>
        <tstamp>
            <format property="TODAY" pattern="yyyy/MM/dd" />
        </tstamp>
        <ejbdoclet destdir="${gensrc.dir}" excludedtags="@version,@author,@todo" addedtags="@xdoclet-generated at ${TODAY}" ejbspec="2.0">
            <!-- ソースファイルの指定 -->
            <fileset dir="${src.dir}">
                <include name="jp/co/hisas/career/learning/**/*EJBBean.java" />
            </fileset>
            <!-- リモート／ホームインターフェイス生成 -->
            <packageSubstitution packages="persistence" substituteWith="interfaces" />
            <remoteinterface pattern="{0}" />
            <homeinterface pattern="{0}Home" />
            <!-- ejb-jar.xmlの生成 -->
            <deploymentdescriptor xmlencoding="MS932" destdir="${gensrc.dir}" />
        </ejbdoclet>
    </target>

    <!-- EJBDoclet -->
    <target name="ejbdoclet2" depends="read-path">
        <mkdir dir="${gensrc.dir}" />
        <!-- XDoclet タスクの定義 -->
        <taskdef name="ejbdoclet" classname="xdoclet.modules.ejb.EjbDocletTask" classpathref="hcdb.classpath">
            <classpath>
                <fileset dir="${xdoclet.home}">
                    <include name="**/*.jar" />
                </fileset>
            </classpath>
        </taskdef>
        <tstamp>
            <format property="TODAY" pattern="yyyy/MM/dd" />
        </tstamp>
        <ejbdoclet destdir="${gensrc.dir}" excludedtags="@version,@author,@todo" addedtags="@xdoclet-generated at ${TODAY}" ejbspec="2.0">
            <!-- ソースファイルの指定 -->
            <fileset dir="${src.dir}">
                <include name="jp/co/hisas/career/department/**/ejb/*EJBBean.java" />
            </fileset>
            <!-- リモート／ホームインターフェイス生成 -->
            <packageSubstitution packages="persistence" substituteWith="interfaces" />
            <remoteinterface pattern="{0}" />
            <homeinterface pattern="{0}Home" />
            <!-- ejb-jar.xmlの生成 -->
            <deploymentdescriptor xmlencoding="MS932" destdir="${gensrc.dir}" />
        </ejbdoclet>
    </target>

    <!-- EJBDoclet -->
    <target name="ejbdoclet3" depends="read-path">
        <mkdir dir="${gensrc.dir}" />
        <!-- XDoclet タスクの定義 -->
        <taskdef name="ejbdoclet" classname="xdoclet.modules.ejb.EjbDocletTask" classpathref="hcdb.classpath">
            <classpath>
                <fileset dir="${xdoclet.home}">
                    <include name="**/*.jar" />
                </fileset>
            </classpath>
        </taskdef>
        <tstamp>
            <format property="TODAY" pattern="yyyy/MM/dd" />
        </tstamp>
        <ejbdoclet destdir="${gensrc.dir}" excludedtags="@version,@author,@todo" addedtags="@xdoclet-generated at ${TODAY}" ejbspec="2.0">
            <!-- ソースファイルの指定 -->
            <fileset dir="${src.dir}">
                <include name="jp/co/hisas/career/base/mail/ejb/*EJBBean.java" />
            </fileset>
            <!-- リモート／ホームインターフェイス生成 -->
            <packageSubstitution packages="persistence" substituteWith="interfaces" />
            <remoteinterface pattern="{0}" />
            <homeinterface pattern="{0}Home" />
            <!-- ejb-jar.xmlの生成 -->
            <deploymentdescriptor xmlencoding="MS932" destdir="${gensrc.dir}" />
        </ejbdoclet>
    </target>

    <!-- EJBDoclet -->
    <target name="ejbdoclet4" depends="read-path">
        <mkdir dir="${gensrc.dir}" />
        <!-- XDoclet タスクの定義 -->
        <taskdef name="ejbdoclet" classname="xdoclet.modules.ejb.EjbDocletTask" classpathref="hcdb.classpath">
            <classpath>
                <fileset dir="${xdoclet.home}">
                    <include name="**/*.jar" />
                </fileset>
            </classpath>
        </taskdef>
        <tstamp>
            <format property="TODAY" pattern="yyyy/MM/dd" />
        </tstamp>
        <ejbdoclet destdir="${gensrc.dir}" excludedtags="@version,@author,@todo" addedtags="@xdoclet-generated at ${TODAY}" ejbspec="2.0">
            <!-- ソースファイルの指定 -->
            <fileset dir="${src.dir}">
                <include name="jp/co/hisas/addon/batch/learning/**/ejb/*EJBBean.java" />
            </fileset>
            <!-- リモート／ホームインターフェイス生成 -->
            <packageSubstitution packages="persistence" substituteWith="interfaces" />
            <remoteinterface pattern="{0}" />
            <homeinterface pattern="{0}Home" />
            <!-- ejb-jar.xmlの生成 -->
            <deploymentdescriptor xmlencoding="MS932" destdir="${gensrc.dir}" />
        </ejbdoclet>
    </target>

    <!-- classes削除-->
    <target name="delete_classes" depends="read-properties">
        <delete dir="${build.class.dir}" />
    </target>

    <!-- JAR、WAR、EAR削除-->
    <target name="delete_lib" depends="read-path" unless="lib-deleted">
        <mkdir dir="${build.lib.dir}" />
        <delete dir="${build.lib.dir}" />
    </target>

    <!-- コンパイル  -->
    <target name="compile" depends="delete_lib">
        <mkdir dir="${build.class.dir}" />
        <javac srcdir="${gensrc.dir};${src.dir}" destdir="${build.class.dir}" classpathref="hcdb.classpath" debug="on" optimize="off" deprecation="on" encoding="MS932" includeantruntime="false">
        </javac>
    </target>

    <!-- career-util.jarファイル作成 -->
    <target name="archive-career_util" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/${career.util.name}">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/common/**" />
                <include name="jp/co/hisas/**/util/**" />
                <exclude name="jp/co/hisas/**/util/pdf/*" />
                <exclude name="jp/co/hisas/career/util/excel/**" />
                <include name="jp/co/hisas/addon/batch/learning/result/**" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/${career.util.name}" todir="${jar.dir}" />
    </target>

	<!-- careerEJB.jarファイル作成 -->
	<target name="make-career-EJB" depends="compile" >
		<mkdir dir="${build.lib.dir}" />
		<jar jarfile="${build.lib.dir}/careerEJB.jar" manifest="xml/manifest.mf">
			<metainf dir="xml">
				<include name="ejb-jar.xml" />
				<include name="sun-ejb-jar.xml" />
			</metainf>
			<fileset dir="${build.class.dir}" >
				<include name="jp/co/hisas/**" />
			</fileset>
		</jar>
	</target>

　  <!-- career.warファイル作成 -->
	<target name="make-career-war" depends="make-career-EJB">
		<mkdir dir="${build.lib.dir}" />
		<copy todir="WEB-INF">
			<fileset dir="xml">
				<include name="sun-web.xml" />
				<include name="*.tld" />
			</fileset>
		</copy>
		<war warfile="${build.lib.dir}/career.war" webxml="xml/web.xml" manifest="xml/manifest.mf">
			<fileset dir="">
				<include name="view/**" />
				<include name="WEB-INF/sun-web.xml" />
				<include name="WEB-INF/*.tld" />
			</fileset>
		</war>
	</target>

    <!-- career.earファイルの作成 -->
	<target name="make-career-ear" depends="make-career-war">
		<mkdir dir="${build.lib.dir}" />
		<ear destfile="${build.lib.dir}/career.ear" appxml="xml/application.xml">
			<metainf dir="xml">
				<include name="cosminexus.xml" />
			</metainf>
			<fileset dir="">
				<include name="library/*.jar" />
			</fileset>
			<fileset dir="${build.lib.dir}">
				<include name="career.war" />
				<include name="careerEJB.jar" />
			</fileset>
		</ear>
	</target>

    <!-- send-followmail.jarファイル作成 -->
    <target name="archive-send-followmail" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/send-followmail.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/batch/learning/sendfollowmail/main/FollowMailSender.class" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/send-followmail.jar" todir="${jar.dir}" />
    </target>

    <!-- sasimodosi-batch.jarファイル作成 -->
    <target name="archive-sasimodosi-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/sasimodosi-batch.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/base/sosiki/bean/*" />
                <include name="jp/co/hisas/addon/batch/learning/sasimodosi/**/*" />
                <include name="jp/co/hisas/career/base/mail/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <include name="jp/co/hisas/career/learning/base/bean/*" />
                <include name="jp/co/hisas/career/learning/base/valuebean/*" />
                <include name="jp/co/hisas/career/learning/base/ejb/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/sasimodosi-batch.jar" todir="${jar.dir}" />
    </target>

    <!-- torikesiUketuke-batch.jarファイル作成 -->
    <target name="archive-torikesiUketuke-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/torikesiUketuke-batch.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/base/sosiki/bean/*" />
                <include name="jp/co/hisas/addon/batch/learning/torikesisinsei/**/*" />
                <include name="jp/co/hisas/career/base/mail/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <include name="jp/co/hisas/career/learning/base/bean/*" />
                <include name="jp/co/hisas/career/learning/base/valuebean/*" />
                <include name="jp/co/hisas/career/learning/base/ejb/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/torikesiUketuke-batch.jar" todir="${jar.dir}" />
    </target>

    <!-- kaikoTuchi-batch.jarファイル作成 -->
    <target name="archive-kaikoTuchi-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/kaikoTuchi-batch.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/base/sosiki/bean/*" />
                <include name="jp/co/hisas/addon/batch/learning/kaikotuchi/**/*" />
                <include name="jp/co/hisas/career/base/mail/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <include name="jp/co/hisas/career/learning/base/bean/*" />
                <include name="jp/co/hisas/career/learning/base/valuebean/*" />
                <include name="jp/co/hisas/career/learning/base/ejb/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/kaikoTuchi-batch.jar" todir="${jar.dir}" />
    </target>

    <!-- syoninsyaMisyouninChikuseki-batch.jarファイル作成 -->
    <target name="archive-syoninsyaMisyouninChikuseki-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/syoninsyaMisyouninChikuseki-batch.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/base/sosiki/bean/*" />
                <include name="jp/co/hisas/addon/batch/learning/misyouninchikuseki/**/*" />
                <include name="jp/co/hisas/career/base/mail/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <include name="jp/co/hisas/career/learning/base/bean/*" />
                <include name="jp/co/hisas/career/learning/base/valuebean/*" />
                <include name="jp/co/hisas/career/learning/base/ejb/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/syoninsyaMisyouninChikuseki-batch.jar" todir="${jar.dir}" />
    </target>

    <!-- kanrisyaMisyoriChikuseki-batch.jarファイル作成 -->
    <target name="archive-kanrisyaMisyoriChikuseki-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/kanrisyaMisyoriChikuseki-batch.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/base/sosiki/bean/*" />
                <include name="jp/co/hisas/addon/batch/learning/misyorichikuseki/**/*" />
                <include name="jp/co/hisas/career/base/mail/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <include name="jp/co/hisas/career/learning/base/bean/*" />
                <include name="jp/co/hisas/career/learning/base/valuebean/*" />
                <include name="jp/co/hisas/career/learning/base/ejb/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/kanrisyaMisyoriChikuseki-batch.jar" todir="${jar.dir}" />
    </target>

    <!-- JyotaiSeni-batch.jarファイル作成 -->
    <target name="archive-JyotaiSeni-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/jyotaiSeni-batch.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/addon/batch/learning/jyotaiSeni/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/jyotaiSeni-batch.jar" todir="${jar.dir}" />
    </target>

    <!-- send-mousikomi-followmail.jarファイル作成 -->
    <target name="archive-send-mousikomi-followmail" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/send-mousikomi-followmail.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/base/sosiki/bean/*" />
                <include name="jp/co/hisas/addon/batch/learning/mousikomi_follow/**/*" />
                <include name="jp/co/hisas/career/base/mail/**/*" />
                <include name="jp/co/hisas/career/learning/base/*" />
                <include name="jp/co/hisas/career/learning/base/bean/*" />
                <include name="jp/co/hisas/career/learning/base/valuebean/*" />
                <include name="jp/co/hisas/career/learning/base/ejb/*" />
                <exclude name="jp/co/hisas/**/ejb/**/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/send-mousikomi-followmail.jar" todir="${jar.dir}" />
    </target>

    <!-- career-tokei.jarファイル作成 -->
    <target name="archive-career-tokei" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/career-tokei.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/batch/Tokei.class" />
                <include name="jp/co/hisas/career/batch/bean/*" />
                <include name="jp/co/hisas/career/batch/sql/*" />
                <include name="jp/co/hisas/career/batch/util/TokeiProperties.class" />
                <include name="jp/co/hisas/career/batch/util/TokeiUtil.class" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/career-tokei.jar" todir="${jar.dir}" />
    </target>

    <!-- career-retiree-delete.jarファイル作成 -->
    <target name="archive-career-retiree-delete" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/career-retiree-delete.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/career/batch/RetireeDelete.class" />
                <include name="jp/co/hisas/career/batch/util/RetireeDeleteProperties.class" />
                <include name="jp/co/hisas/career/batch/util/TokeiUtil.class" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/career-retiree-delete.jar" todir="${jar.dir}" />
    </target>

    <!-- sosiki-update.jarファイル作成 -->
    <target name="archive-soshiki-batch" depends="compile">
        <delete file="${build.class.dir}/jp/co/hisas/addon/batch/soshikiupdate/resource/Message.properties" />
        <mkdir dir="${src.dir}/jp/co/hisas/addon/batch/soshikiupdate/resource" />
        <mkdir dir="${build.class.dir}/jp/co/hisas/addon/batch/soshikiupdate/resource" />
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/sosiki-update.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/addon/batch/soshikiupdate/main/*.class" />
                <include name="jp/co/hisas/addon/batch/soshikiupdate/vo/*.class" />
                <include name="jp/co/hisas/addon/batch/soshikiupdate/exception/*.class" />
                <include name="jp/co/hisas/addon/batch/soshikiupdate/man/*.class" />
                <include name="jp/co/hisas/addon/batch/soshikiupdate/resource/*.*" />
            </fileset>
            <manifest>
                <attribute name="Main-Class" value="jp.co.hisas.addon.batch.soshikiupdate.main.BatchMain" />
            </manifest>
        </jar>
        <copy file="${build.lib.dir}/sosiki-update.jar" todir="${jar.dir}" />
    </target>

    <!-- import-personal.jarファイル作成 -->
    <target name="archive-import-personal" depends="compile">
        <delete file="${build.class.dir}/jp/co/hisas/addon/batch/import_personal/resource/Message.properties" />
        <mkdir dir="${src.dir}/jp/co/hisas/addon/batch/soshikiupdate/resource" />
        <mkdir dir="${build.class.dir}/jp/co/hisas/addon/batch/soshikiupdate/resource" />
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/import-personal.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/addon/batch/import_personal/util/*" />
                <include name="jp/co/hisas/addon/batch/import_personal/vo/*" />
                <include name="jp/co/hisas/addon/batch/import_personal/exception/*" />
                <include name="jp/co/hisas/addon/batch/import_personal/man/*" />
                <include name="jp/co/hisas/addon/batch/import_personal/import_personal/*" />
                <include name="jp/co/hisas/addon/batch/import_personal/ejb/*" />
                <include name="jp/co/hisas/addon/batch/import_personal/resource/*" />
                <exclude name="jp/co/hisas/addon/batch/soshikiupdate/ejb/*EJBBean*" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/import-personal.jar" todir="${jar.dir}" />
    </target>

    <!-- learningPh1.jarファイル作成 -->
    <target name="learningPh1-batch" depends="compile">
        <mkdir dir="${build.lib.dir}" />
        <jar jarfile="${build.lib.dir}/learningPh1.jar">
            <fileset dir="${build.class.dir}">
                <include name="jp/co/hisas/addon/batch/learning/util/*.class" />
                <include name="jp/co/hisas/addon/batch/learning/kensyurekiiko/MoveTrainingHistoryBatch.class" />
                <include name="jp/co/hisas/addon/batch/learning/kensyurekiiko/bean/L51Bean.class" />
                <include name="jp/co/hisas/addon/batch/learning/kensyudatasakujyo/DeleteClassBatch.class" />
            </fileset>
        </jar>
        <copy file="${build.lib.dir}/learningPh1.jar" todir="${jar.dir}" />
    </target>

    <!-- バッチ関連JARの作成 -->
    <target name="make-batch-jar" depends="archive-career_util" description="バッチJARファイルビルド">
        <property name="lib-deleted" value="true" />
        <antcall target="archive-sasimodosi-batch" />
        <antcall target="archive-torikesiUketuke-batch" />
        <antcall target="archive-kaikoTuchi-batch" />
        <antcall target="archive-syoninsyaMisyouninChikuseki-batch" />
        <antcall target="archive-kanrisyaMisyoriChikuseki-batch" />
        <antcall target="archive-JyotaiSeni-batch" />
        <antcall target="archive-send-mousikomi-followmail" />
        <antcall target="archive-career-tokei" />
        <antcall target="archive-soshiki-batch" />
        <antcall target="archive-import-personal" />
        <antcall target="archive-career-retiree-delete" />
        <antcall target="learningPh1-batch" />
        <antcall target="archive-send-followmail" />
    </target>

    <!-- JavaDocの作成 -->
    <target name="javadoc" depends="read-properties">
        <mkdir dir="${javadoc.dir}" />
        <javadoc windowtitle="リシテアCareer" sourcepath="${src.dir}" packagenames="jp.co.hisas.career.*.*" destdir="${javadoc.dir}" />
    </target>
</project>
