<?xml version="1.0" encoding="Shift_JIS"?>

<project name="hcdb"  default="make-career-ear" basedir="..">
	<!-- プロパティファイルのコピー  -->
	<target name="copy-properties">
		<copy file="make/build-sample.properties" tofile="make/build.properties" />
	</target>

	<!-- プロパティファイルの読み込み  -->
	<target name="read-properties" depends="copy-properties">
		<loadproperties srcFile="make/build.properties" />
	</target>

	<!-- クラスパスの定義 -->
	<target name="read-path" depends="read-properties">
		<path id="hcdb.classpath">
			<fileset dir="${lib.dir}">
				<include name="**/*.jar" />
			</fileset>
		</path>
	</target>

	<!-- JAR、WAR、EAR削除-->
	<target name="delete_lib" depends="read-path">
		<mkdir dir="${build.lib.dir}" />
		<delete dir="${build.lib.dir}" />
	</target>

	<!-- コンパイル  -->
	<target name="compile" depends="delete_lib">
		<mkdir dir="${build.class.dir}" />
		<javac
			srcdir="${gensrc.dir};${src.dir}"
			destdir="${build.class.dir}"
			classpathref="hcdb.classpath"
			debug="on"
			optimize="off"
			deprecation="on"
			encoding="MS932"
			includeantruntime="false">
		</javac>
	</target>

	<!-- career-util.jarファイル作成 -->
	<target name="archive-career_util" depends="compile" >
		<mkdir dir="${build.lib.dir}" />
		<jar jarfile="${build.lib.dir}/${career.util.name}" manifest="xml/manifest.mf">
			<metainf dir="xml">
				<include name="ejb-jar.xml" />
				<include name="sun-ejb-jar.xml" />
			</metainf>
			<fileset dir="${build.class.dir}" >
				<include name="jp/co/hisas/**" />
			</fileset>
		</jar>
	</target>

	<!-- career.warファイル作成 -->
	<target name="make-war" depends="archive-career_util">
		<mkdir dir="${build.lib.dir}" />
		<copy todir="WEB-INF">
			<fileset dir="xml">
				<include name="sun-web.xml" />
				<include name="*.tld" />
			</fileset>
		</copy>
		<war warfile="${build.lib.dir}/career.war" webxml="xml/web.xml" manifest="xml/manifest.mf">
			<fileset dir="">
				<include name="view/**" />
				<include name="WEB-INF/sun-web.xml" />
				<include name="WEB-INF/*.tld" />
			</fileset>
		</war>
	</target>

	<!-- make-ear[Oracle,Cosminexus] -->
	<target name="make-career-ear" depends="make-war">
		<mkdir dir="${build.lib.dir}" />
		<ear destfile="${build.lib.dir}/career.ear" appxml="xml/application.xml">
			<metainf dir="xml">
				<include name="cosminexus.xml" />
			</metainf>
			<fileset dir="">
				<include name="library/*.jar" />
			</fileset>
			<fileset dir="${build.lib.dir}">
				<include name="*.war" />
				<include name="career-util.jar" />
			</fileset>
		</ear>
	</target>
</project>
